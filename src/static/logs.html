<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
  <title>日志展示</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { 
      font-family: 'Microsoft YaHei', sans-serif; 
      background-color: #f8f9fa;
      padding: 20px;
    }
    .card {
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      border: none;
    }
    .card-header {
      background-color: #fff;
      border-bottom: 1px solid rgba(0, 0, 0, 0.125);
      font-weight: bold;
    }
    .btn-primary {
      background-color: #6f42c1;
      border-color: #6f42c1;
    }
    .btn-primary:hover {
      background-color: #5a32a3;
      border-color: #5a32a3;
    }
    .navbar-brand {
      font-weight: bold;
    }
    h1 {
      color: #6f42c1;
    }
    #log { 
      height: 80vh;
      overflow: auto;
      background: #f8f9fa;
      padding: 15px;
      border: 1px solid #dee2e6;
      border-radius: 0.375rem;
      font-family: monospace;
      font-size: 0.875em;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">📝 日志展示</a>
    </div>
  </nav>

  <div class="container">
    <div class="card">
      <div class="card-body">
        <div class="d-grid gap-2 d-md-flex justify-content-md-start">
          <button class="btn btn-primary me-md-2" type="button" onclick="refreshLog()">
            刷新日志
          </button>
          <button class="btn btn-secondary" type="button" onclick="clearLog()">
            清空显示
          </button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        日志内容
      </div>
      <div class="card-body">
        <div id="log"></div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let logContent = '';
    
    async function refreshLog(){
      try {
        const txt = await fetch('/api/logs').then(r=>r.text());
        const logEl = document.getElementById('log');
        logContent = txt;
        logEl.textContent = txt;
        logEl.scrollTop = logEl.scrollHeight;
      } catch (e) {
        console.error('获取日志失败:', e);
      }
    }
    
    function clearLog() {
      const logEl = document.getElementById('log');
      logEl.textContent = '';
      logContent = '';
    }
    
    function updateLog(newData) {
      const logEl = document.getElementById('log');
      logContent += newData + "\n";
      logEl.textContent = logContent;
      logEl.scrollTop = logEl.scrollHeight;
    }
    
    // 页面加载完成后初始化
    window.addEventListener('load', function() {
      refreshLog();
      setInterval(refreshLog, 2000);
      
      // 连接服务器发送事件流
      const source = new EventSource('/stream_logs');
      source.onmessage = e => {
        updateLog(e.data);
      };
      
      source.onerror = e => {
        console.error('SSE连接错误:', e);
      };
    });
  </script>
</body>
</html>